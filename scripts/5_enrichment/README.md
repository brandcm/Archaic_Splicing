This repository contains scripts needed to conduct an analysis to assess enrichment for splice altering variants in various human phenotypes among different gene sets. This approach emulates that of [McArthur et al. 2022](https://www.biorxiv.org/content/10.1101/2022.02.07.479462v1.full). We considered eight different gene sets using a splice altering probability threshold of 0.2: 1) archaic-specific Altai-specific variants, 2) archaic-specific Chagyrskaya-specific variants, 3) archaic-specific Denisovan-specific variants, 4) archaic-specific Vindija-specific variants, 5) archaic-specific Neanderthal-specific variants, 6) archaic-specific shared variants (i.e., those in all four archaics), 7) archaic-specific variants, and 8) introgressed variants. 

Why not use existing gene ontology methods? Genes vary in their 'susceptability' to mutations, particularly those that could affect alternative splicing because genes vary in their physical characteristics (e.g., length, number of exons, etc). Relatedly, using all (or many) genes in the genome underpowers enrichment analyses, especially when some genes may not even be represented by analyzed variants.

These scripts conduct an enrichment analyis using an empirical null distribution. This distribution is created by shuffling the splice altering probability values among all archaic variants, subsetting the relevent gene set (e.g., variant specific to the Altai neanderthal), and then recording how many genes involved in a particular human phenotype from the 2019 GWAS Catolog or Human Phenotype Ontology are observed. Enrichment can then be calculated using the mean number of genes from the empirical distribution compared to the actual number of genes observed in the real data. P values reflect how often the empirical values were more extreme than the observed. We can also calculate an adjusted p value threshold that controls the false discovery rate using a subset of the empirical null.

Please note that these scripts were not launched in a Jupyter notebook and must be done so manually after the gene lists have been generated in the main analysis notebook. The scripts below are listed in the order in which they should be launched.

- gene_set_to_observed.sh launches the gene_set_to_observed.py script that generates files indicating which of the observed genes for each set are present in the GWAS and HPO terms.

- *_empiric_counts.sh launches the associated *_empiric_counts.py script that generates the empirical null distribution per set. GWAS and HPO terms that do not include at least one gene from each gene set are not included. These files exist separately for each gene set because Python was not amused by my attempts to code the data filtering criteria directly into the command line. Sigh. Note that these scripts make use of arrays to speed things up. The final lines stitch all these split files together and also retain the original split files just in case!

- enrichment.sh launches enrichment.py, which calculates enrichment and p values for each term with an empirical distribution.

- empiric_FDR.sh launches empiric_FDR.py that generates data from a subset of the empirical nulls to calculate an adjusted p value threshold controlling for a user-specified false discovery rate (we used 0.05 and 0.1). 
